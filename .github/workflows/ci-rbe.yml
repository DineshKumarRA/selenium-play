name: CI - RBE

on:
  pull_request:
  push:
    branches:
      - trunk
  workflow_dispatch:

jobs:
  format:
    runs-on: ubuntu-latest
    steps:
      - name: Format
        run: echo '${{ github.repository_owner }}' '${{ github.ref }}'
    # if: >
    #   github.repository_owner == 'DineshKumarRA' &&
    #   !contains(github.ref, 'renovate/')
    # uses: ./.github/workflows/bazel.yml
    # with:
    #   name: Check format script run
    #   caching: false
    #   ruby-version: jruby-9.4.8.0
    #   run: ./scripts/github-actions/check-format.sh

  test:
    name: Test
    if: >
      github.repository_owner == 'DineshKumarRA' &&
      !contains(github.ref, 'renovate/')
    uses: ./.github/workflows/bazel.yml
    with:
      name: All RBE tests
      caching: false
      ruby-version: jruby-9.4.8.0
      run: ./scripts/github-actions/ci-build.sh
